def calculate_gpa(db, student_id):
    db.cursor.execute("""
        SELECT c.credit_unit, e.score
        FROM enrollments e
        JOIN courses c ON e.course_id = c.id
        WHERE e.student_id=?
    """, (student_id,))

    records = db.cursor.fetchall()

    total_points = 0
    total_units = 0

    for credit_unit, score in records:
        if score >= 70:
            grade_point = 5
        elif score >= 60:
            grade_point = 4
        elif score >= 50:
            grade_point = 3
        elif score >= 45:
            grade_point = 2
        elif score >= 40:
            grade_point = 1
        else:
            grade_point = 0

        total_points += grade_point * credit_unit
        total_units += credit_unit

    if total_units == 0:
        return 0

    return round(total_points / total_units, 2)
